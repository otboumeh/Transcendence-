<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        button { padding: 10px; margin: 5px; cursor: pointer; }
        pre { background: #000; padding: 10px; border: 1px solid #0f0; }
        .ok { color: #0f0; }
        .error { color: #f00; }
    </style>
</head>
<body>
    <h1>üîç Debug de Login</h1>
    
    <h2>1. Test de LocalStorage</h2>
    <button onclick="testLocalStorage()">Test LocalStorage</button>
    <pre id="localStorageTest"></pre>

    <h2>2. Login Manual</h2>
    <button onclick="doLogin()">Login como testuser1</button>
    <pre id="loginResult"></pre>

    <h2>3. Estado Actual</h2>
    <button onclick="checkStatus()">Ver Estado</button>
    <pre id="statusResult"></pre>

    <h2>4. Limpiar Todo</h2>
    <button onclick="clearAll()">Limpiar localStorage</button>

    <script>
        function testLocalStorage() {
            const result = document.getElementById('localStorageTest');
            try {
                localStorage.setItem('test', 'value');
                const val = localStorage.getItem('test');
                localStorage.removeItem('test');
                result.innerHTML = '<span class="ok">‚úÖ LocalStorage funciona correctamente</span>';
            } catch(e) {
                result.innerHTML = '<span class="error">‚ùå Error: ' + e.message + '</span>';
            }
        }

        async function doLogin() {
            const result = document.getElementById('loginResult');
            result.innerHTML = '‚è≥ Haciendo login...';
            
            try {
                const response = await fetch('https://localhost:9443/api/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'testuser1', pass: 'Test123!' })
                });
                
                const data = await response.json();
                result.innerHTML = 'üì¶ Response:\n' + JSON.stringify(data, null, 2);
                
                if (data.details && data.test_mode) {
                    localStorage.setItem('userId', String(data.user_id));
                    localStorage.setItem('tokenUser', data.details);
                    result.innerHTML += '\n\n<span class="ok">‚úÖ Token guardado en localStorage</span>';
                    checkStatus();
                }
            } catch(e) {
                result.innerHTML = '<span class="error">‚ùå Error: ' + e.message + '</span>';
            }
        }

        function checkStatus() {
            const result = document.getElementById('statusResult');
            const userId = localStorage.getItem('userId');
            const token = localStorage.getItem('tokenUser');
            
            result.innerHTML = `
UserId: ${userId || '<span class="error">NULL</span>'}
Token: ${token ? '<span class="ok">' + token.substring(0, 50) + '...</span>' : '<span class="error">NULL</span>'}

Todos los items en localStorage:
${Object.keys(localStorage).map(key => `  ${key}: ${localStorage.getItem(key)?.substring(0, 30)}...`).join('\n')}
            `;
        }

        function clearAll() {
            localStorage.clear();
            alert('‚úÖ localStorage limpiado');
            checkStatus();
        }

        // Auto-check al cargar
        window.addEventListener('load', () => {
            testLocalStorage();
            checkStatus();
        });
    </script>
</body>
</html>
